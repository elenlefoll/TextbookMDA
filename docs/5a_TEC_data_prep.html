<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Textbook English: A Multi-Dimensional Approach - 2&nbsp; Data import from MFTE output</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./summary.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./5a_TEC_data_prep.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data import from MFTE output</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Textbook English: A Multi-Dimensional Approach</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5a_TEC_data_prep.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data import from MFTE output</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#summary-statistics" id="toc-summary-statistics" class="nav-link active" data-scroll-target="#summary-statistics"><span class="header-section-number">2.1</span> Summary statistics</a></li>
  <li>
<a href="#data-preparation-for-pca" id="toc-data-preparation-for-pca" class="nav-link" data-scroll-target="#data-preparation-for-pca"><span class="header-section-number">3</span> Data preparation for PCA</a>
  <ul class="collapse">
<li><a href="#removal-of-poetry-texts" id="toc-removal-of-poetry-texts" class="nav-link" data-scroll-target="#removal-of-poetry-texts"><span class="header-section-number">3.1</span> Removal of Poetry texts</a></li>
  <li>
<a href="#feature-distributions" id="toc-feature-distributions" class="nav-link" data-scroll-target="#feature-distributions"><span class="header-section-number">3.2</span> Feature distributions</a>
  <ul class="collapse">
<li><a href="#feature-removal-i" id="toc-feature-removal-i" class="nav-link" data-scroll-target="#feature-removal-i"><span class="header-section-number">3.2.1</span> Feature removal I</a></li>
  <li><a href="#standardising-normalised-counts-and-identifying-potential-outliers" id="toc-standardising-normalised-counts-and-identifying-potential-outliers" class="nav-link" data-scroll-target="#standardising-normalised-counts-and-identifying-potential-outliers"><span class="header-section-number">3.2.2</span> Standardising normalised counts and identifying potential outliers</a></li>
  <li><a href="#transforming-the-features-to-partially-deskew-these-distributions" id="toc-transforming-the-features-to-partially-deskew-these-distributions" class="nav-link" data-scroll-target="#transforming-the-features-to-partially-deskew-these-distributions"><span class="header-section-number">3.2.3</span> Transforming the features to (partially) deskew these distributions</a></li>
  <li><a href="#visualisation-of-feature-correlations" id="toc-visualisation-of-feature-correlations" class="nav-link" data-scroll-target="#visualisation-of-feature-correlations"><span class="header-section-number">3.2.4</span> Visualisation of feature correlations</a></li>
  </ul>
</li>
  <li><a href="#composition-of-tec-textsfiles-entered-in-the-mdas" id="toc-composition-of-tec-textsfiles-entered-in-the-mdas" class="nav-link" data-scroll-target="#composition-of-tec-textsfiles-entered-in-the-mdas"><span class="header-section-number">3.3</span> Composition of TEC texts/files entered in the MDAs</a></li>
  </ul>
</li>
  <li><a href="#packages-used-in-this-script" id="toc-packages-used-in-this-script" class="nav-link" data-scroll-target="#packages-used-in-this-script"><span class="header-section-number">4</span> Packages used in this script</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data import from MFTE output</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>This document outlines the steps taken to pre-process the Textbook English Corpus (TEC) data.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#renv::restore() # Restore the project's dependencies from the lockfile to ensure that same package versions are used as in the original thesis.</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span> <span class="co"># For its confusion matrix function</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span> <span class="co"># For dynamic file paths</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span> <span class="co"># For Fig. 1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/braverock/PerformanceAnalytics">PerformanceAnalytics</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://personality-project.org/r/psych/">psych</a></span><span class="op">)</span> <span class="co"># For various useful stats function</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Read in Textbook Corpus data</span></span>
<span><span class="co"># This .tsv file corresponds to the "mixed normalised frequency" output of the MFTE Perl v. 3.1</span></span>
<span><span class="va">TxBcounts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"MFTE_data"</span>, <span class="st">"Outputs"</span>, <span class="st">"TxB900MDA_3.1_normed_complex_counts.tsv"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">TxBcounts</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Filename</span><span class="op">!=</span><span class="st">".DS_Store"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">)</span> <span class="co"># Check sanity of data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2014 obs. of  84 variables:
 $ Filename: Factor w/ 2014 levels "Access_1_Informative_0001.txt",..: 333 2008 1644 389 447 1666 237 477 1317 16 ...
 $ Words   : int  931 889 750 979 690 694 547 967 927 840 ...
 $ AWL     : num  4.57 4.48 3.9 3.99 4.7 ...
 $ TTR     : num  0.4 0.435 0.505 0.453 0.59 ...
 $ LD      : num  0.594 0.533 0.516 0.545 0.59 ...
 $ DT      : num  33 41.9 39.4 21.1 28.2 ...
 $ JJAT    : num  7.93 8.73 18.9 7.37 25.74 ...
 $ POS     : num  2.2 0 0 0 0.99 ...
 $ NCOMP   : num  7.93 3.93 4.72 16.84 12.87 ...
 $ QUAN    : num  2.2 5.68 11.02 6.84 2.97 ...
 $ ACT     : num  22.4 36.2 23.9 30.6 43.8 ...
 $ ASPECT  : num  3.731 8.511 2.817 0.901 6.25 ...
 $ CAUSE   : num  0 1.06 1.41 2.7 2.08 ...
 $ COMM    : num  29.85 24.47 9.86 8.11 16.67 ...
 $ CUZ     : num  0 0 1.409 0.901 0 ...
 $ CC      : num  22.4 30.9 45.1 27.9 68.8 ...
 $ CONC    : num  0 0 0 0 4.17 ...
 $ COND    : num  1.49 0 1.41 1.8 0 ...
 $ EX      : num  0.746 0 0 2.703 0 ...
 $ EXIST   : num  0.746 2.128 8.451 1.802 12.5 ...
 $ ELAB    : num  0 0 0 0 0 ...
 $ FREQ    : num  3.731 3.192 2.817 0.901 2.083 ...
 $ JJPR    : num  8.21 8.51 12.68 13.51 12.5 ...
 $ MENTAL  : num  25.4 21.3 36.6 28.8 20.8 ...
 $ OCCUR   : num  0.746 3.192 7.042 0 0 ...
 $ DOAUX   : num  8.96 7.45 1.41 17.12 0 ...
 $ QUTAG   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ QUPR    : num  0.746 0 5.634 0.901 4.167 ...
 $ SPLIT   : num  0 0 1.409 0.901 4.167 ...
 $ STPR    : num  0.746 3.192 1.409 2.703 0 ...
 $ WHQU    : num  18.66 13.83 8.45 11.71 0 ...
 $ THSC    : num  1.492 2.128 0 0.901 2.083 ...
 $ WHSC    : num  5.22 6.38 5.63 3.6 16.67 ...
 $ CONT    : num  3.73 0 19.72 30.63 4.17 ...
 $ VBD     : num  1.49 9.57 38.03 3.6 18.75 ...
 $ VPRT    : num  35.1 31.9 26.8 75.7 54.2 ...
 $ PLACE   : num  0.746 2.128 0 4.505 6.25 ...
 $ PROG    : num  5.22 3.19 2.82 7.21 6.25 ...
 $ HGOT    : num  0 0 0 1.8 0 ...
 $ BEMA    : num  8.96 8.51 19.72 17.12 14.58 ...
 $ MDCA    : num  1.49 3.19 1.41 3.6 4.17 ...
 $ MDCO    : num  0 0 1.41 0 0 ...
 $ TIME    : num  2.99 2.13 5.63 4.5 2.08 ...
 $ THATD   : num  5.22 0 0 3.6 0 ...
 $ THRC    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ VIMP    : num  59.7 53.19 2.82 6.31 6.25 ...
 $ MDMM    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ ABLE    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ MDNE    : num  0 0 4.23 6.31 6.25 ...
 $ MDWS    : num  1.49 0 2.82 1.8 10.42 ...
 $ MDWO    : num  0.746 2.128 22.535 2.703 0 ...
 $ XX0     : num  2.24 4.26 7.04 9.01 4.17 ...
 $ PASS    : num  0.746 2.128 2.817 1.802 4.167 ...
 $ PGET    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ VBG     : num  0.746 10.638 7.042 10.811 14.583 ...
 $ VBN     : num  0 3.19 0 0 4.17 ...
 $ PEAS    : num  0 0 0 0.901 4.167 ...
 $ GTO     : num  0.746 0 2.817 0 0 ...
 $ FPP1S   : num  0.746 1.064 60.563 45.946 0 ...
 $ FPP1P   : num  0 0 18.3 22.5 20.8 ...
 $ TPP3S   : num  3.731 7.447 1.409 0.901 0 ...
 $ TPP3P   : num  5.97 4.26 0 1.8 12.5 ...
 $ SPP2    : num  23.9 29.8 23.9 29.7 33.3 ...
 $ PIT     : num  1.49 0 7.04 11.71 12.5 ...
 $ PRP     : num  0 0 0 0 0 ...
 $ RP      : num  0 5.319 4.225 0.901 6.25 ...
 $ AMP     : num  0 0.113 0.267 0.102 0.145 ...
 $ CD      : num  0.43 1.012 2.4 0.511 1.304 ...
 $ DEMO    : num  0.537 0.562 0.267 0.306 0.145 ...
 $ DMA     : num  0.107 0 2 0.204 0 ...
 $ DWNT    : num  0 0 0.133 0.204 0 ...
 $ EMO     : num  0 0 0 0 0 0 0 0 0 0 ...
 $ EMPH    : num  0 0.113 0.667 0.715 0.29 ...
 $ FPUH    : num  0 0.113 0.8 0.102 0 ...
 $ HDG     : num  0.107 0 0.667 0 0.145 ...
 $ HST     : num  0 0 0 0 0 0 0 0 0 0 ...
 $ IN      : num  10.31 14.4 10.13 7.97 10.87 ...
 $ LIKE    : num  0.215 0.225 0.4 0.204 0 ...
 $ NN      : num  24.4 25.8 16.9 19.4 29.3 ...
 $ POLITE  : num  0 0 0.4 0.306 0 ...
 $ RB      : num  1.074 0.338 1.467 1.941 0.725 ...
 $ SO      : num  0 0 0.267 0.409 0.29 ...
 $ URL     : num  0 0 0 0 0 ...
 $ YNQU    : num  0.43 1.012 0.667 0.511 0 ...</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">)</span> <span class="co"># Should be 2014 files</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 2014</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Adding a textbook proficiency level</span></span>
<span><span class="va">TxBLevels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"metadata"</span>, <span class="st">"TxB900MDA_ProficiencyLevels.csv"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">TxBcounts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">TxBcounts</span>, <span class="va">TxBLevels</span>, by <span class="op">=</span> <span class="st">"Filename"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Level</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Filename</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Level</span><span class="op">)</span> <span class="co"># Check distribution and that there are no NAs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  A   B   C   D   E 
292 407 506 478 331 </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Filename</span>, <span class="va">Level</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="co"># Check matching on random sample</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                                           Filename Level
1                     Access_3_Informative_0001.txt     C
2                          Access_3_Spoken_0013.txt     C
3                        JTT_3_Informative_0007.txt     D
4                New_GreenLine_1_Narrative_0004.txt     A
5                           HT_4_Narrative_0004.txt     C
6  Solutions_Intermediate_Plus_Informative_0016.txt     D
7                      JTT_3_Instructional_0009.txt     D
8                GreenLine_1_Instructional_0004.txt     A
9           Piece_of_cake_3e_Instructional_0008.txt     D
10                          NB_2_Narrative_0010.txt     E
11                  Access_5_Instructional_0004.txt     E
12                         Access_2_Spoken_0002.txt     B
13                 GreenLine_2_Informative_0001.txt     B
14                         Access_4_Spoken_0012.txt     D
15                Achievers_B1_plus_Spoken_0003.txt     D
16                  New_GreenLine_5_Spoken_0001.txt     E
17              Achievers_B1_plus_Personal_0001.txt     D
18                   GreenLine_4_Narrative_0010.txt     D
19               New_GreenLine_3_Narrative_0005.txt     C
20         English_in_Mind_3_Instructional_0006.txt     C</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Adding a register variable from the file names</span></span>
<span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Register</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Filename</span>, <span class="st">"Spoken|Narrative|Other|Personal|Informative|Instructional|Poetry"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Add a variable for Textbook Register</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Register</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  Informative Instructional     Narrative      Personal        Poetry 
          364           647           285            88            37 
       Spoken 
          593 </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Register</span> <span class="op">&lt;-</span> <span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/recode.html">recode</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Register</span>, <span class="st">"'Narrative' = 'Fiction'; 'Spoken' = 'Conversation'"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">)</span> <span class="co"># Check all the variables make sense</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> [1] "Filename" "Words"    "AWL"      "TTR"      "LD"       "DT"      
 [7] "JJAT"     "POS"      "NCOMP"    "QUAN"     "ACT"      "ASPECT"  
[13] "CAUSE"    "COMM"     "CUZ"      "CC"       "CONC"     "COND"    
[19] "EX"       "EXIST"    "ELAB"     "FREQ"     "JJPR"     "MENTAL"  
[25] "OCCUR"    "DOAUX"    "QUTAG"    "QUPR"     "SPLIT"    "STPR"    
[31] "WHQU"     "THSC"     "WHSC"     "CONT"     "VBD"      "VPRT"    
[37] "PLACE"    "PROG"     "HGOT"     "BEMA"     "MDCA"     "MDCO"    
[43] "TIME"     "THATD"    "THRC"     "VIMP"     "MDMM"     "ABLE"    
[49] "MDNE"     "MDWS"     "MDWO"     "XX0"      "PASS"     "PGET"    
[55] "VBG"      "VBN"      "PEAS"     "GTO"      "FPP1S"    "FPP1P"   
[61] "TPP3S"    "TPP3P"    "SPP2"     "PIT"      "PRP"      "RP"      
[67] "AMP"      "CD"       "DEMO"     "DMA"      "DWNT"     "EMO"     
[73] "EMPH"     "FPUH"     "HDG"      "HST"      "IN"       "LIKE"    
[79] "NN"       "POLITE"   "RB"       "SO"       "URL"      "YNQU"    
[85] "Level"    "Register"</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Adding a textbook series variable from the file names</span></span>
<span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Filename</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Filename</span>, <span class="st">"English_In_Mind|English_in_Mind"</span>, <span class="st">"EIM"</span><span class="op">)</span> </span>
<span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Filename</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Filename</span>, <span class="st">"New_GreenLine"</span>, <span class="st">"NGL"</span><span class="op">)</span> <span class="co"># Otherwise the regex for GreenLine will override New_GreenLine</span></span>
<span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Filename</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Filename</span>, <span class="st">"Piece_of_cake"</span>, <span class="st">"POC"</span><span class="op">)</span> <span class="co"># Shorten label for ease of plotting</span></span>
<span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Filename</span>, <span class="st">"Access|Achievers|EIM|GreenLine|HT|NB|NM|POC|JTT|NGL|Solutions"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Series</span><span class="op">)</span> <span class="co"># Extract textbook series from (ammended) filenames</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   Access Achievers       EIM GreenLine        HT       JTT        NB       NGL 
      315       240       180       209       115       129        44       298 
       NM       POC Solutions 
       59        98       327 </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Including the French textbooks for the first year of Lycée to their corresponding publisher series from collège</span></span>
<span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Series</span> <span class="op">&lt;-</span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/recode.html">recode</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Series</span>, <span class="st">"c('NB', 'JTT') = 'JTT'; c('NM', 'HT') = 'HT'"</span><span class="op">)</span> <span class="co"># # Recode final volumes of French series (see Section 4.3.1.1 on textbook selection for details)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Series</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   Access Achievers       EIM GreenLine        HT       JTT       NGL       POC 
      315       240       180       209       174       173       298        98 
Solutions 
      327 </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Adding a textbook country of use variable from the series variable</span></span>
<span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Country</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span><span class="op">$</span><span class="va">Series</span></span>
<span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Country</span> <span class="op">&lt;-</span> <span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/recode.html">recode</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Series</span>, <span class="st">"c('Access', 'GreenLine', 'NGL') = 'Germany'; c('Achievers', 'EIM', 'Solutions') = 'Spain'; c('HT', 'NB', 'NM', 'POC', 'JTT') = 'France'"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Country</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> France Germany   Spain 
    445     822     747 </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Re-order variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> [1] "Filename" "Words"    "AWL"      "TTR"      "LD"       "DT"      
 [7] "JJAT"     "POS"      "NCOMP"    "QUAN"     "ACT"      "ASPECT"  
[13] "CAUSE"    "COMM"     "CUZ"      "CC"       "CONC"     "COND"    
[19] "EX"       "EXIST"    "ELAB"     "FREQ"     "JJPR"     "MENTAL"  
[25] "OCCUR"    "DOAUX"    "QUTAG"    "QUPR"     "SPLIT"    "STPR"    
[31] "WHQU"     "THSC"     "WHSC"     "CONT"     "VBD"      "VPRT"    
[37] "PLACE"    "PROG"     "HGOT"     "BEMA"     "MDCA"     "MDCO"    
[43] "TIME"     "THATD"    "THRC"     "VIMP"     "MDMM"     "ABLE"    
[49] "MDNE"     "MDWS"     "MDWO"     "XX0"      "PASS"     "PGET"    
[55] "VBG"      "VBN"      "PEAS"     "GTO"      "FPP1S"    "FPP1P"   
[61] "TPP3S"    "TPP3P"    "SPP2"     "PIT"      "PRP"      "RP"      
[67] "AMP"      "CD"       "DEMO"     "DMA"      "DWNT"     "EMO"     
[73] "EMPH"     "FPUH"     "HDG"      "HST"      "IN"       "LIKE"    
[79] "NN"       "POLITE"   "RB"       "SO"       "URL"      "YNQU"    
[85] "Level"    "Register" "Series"   "Country" </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TxBcounts</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Order alphabetically first</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Filename</span>, <span class="va">Country</span>, <span class="va">Series</span>, <span class="va">Level</span>, <span class="va">Register</span>, <span class="va">Words</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="summary-statistics" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="summary-statistics">
<span class="header-section-number">2.1</span> Summary statistics</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Register</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>totaltexts <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, totalwords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Words</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Words</span><span class="op">)</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">Words</span><span class="op">)</span><span class="op">)</span>, TTRmean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">TTR</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  Register      totaltexts totalwords  mean    sd TTRmean
  &lt;fct&gt;              &lt;int&gt;      &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;
1 Conversation         593     505147   851   301   0.438
2 Fiction              285     241512   847   208   0.472
3 Informative          364     304695   837   177   0.514
4 Instructional        647     585049   904    94   0.421
5 Personal              88      69570   790   177   0.477
6 Poetry                37      26445   714   192   0.436</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#TxBcounts &lt;- saveRDS(TxBcounts, here("processed_data", "TxBcounts.rds"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="data-preparation-for-pca" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Data preparation for PCA</h1>
<section id="removal-of-poetry-texts" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="removal-of-poetry-texts">
<span class="header-section-number">3.1</span> Removal of Poetry texts</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 2014</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TxBcounts</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Register</span><span class="op">!=</span><span class="st">"Poetry"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1977</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">$</span><span class="va">Register</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> Conversation       Fiction   Informative Instructional      Personal 
          593           285           364           647            88 </code></pre>
</div>
</div>
</section><section id="feature-distributions" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="feature-distributions">
<span class="header-section-number">3.2</span> Feature distributions</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Words</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">keep</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># This function from tidyr converts a selection of variables into two variables: a key and a value. The key contains the names of the original variable and the value the data. This means we can then use the facet_wrap function from ggplot2</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">key</span>, scales <span class="op">=</span> <span class="st">"free"</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, colour<span class="op">=</span> <span class="st">"darkred"</span>, fill <span class="op">=</span> <span class="st">"darkred"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="5a_TEC_data_prep_files/figure-html/distribution-viz-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#ggsave(here("plots", "TEC-HistogramPlotsAllVariablesTEC-only.svg"), width = 20, height = 45)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="feature-removal-i" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="feature-removal-i">
<span class="header-section-number">3.2.1</span> Feature removal I</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Removal of meaningless features:</span></span>
<span><span class="co"># CD because numbers as digits were mostly removed from the textbooks</span></span>
<span><span class="co"># LIKE and SO because they are "bin" features designed to ensure that the counts for these two words don't inflate other categories due to mistags.</span></span>
<span><span class="va">TxBcounts</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">CD</span>, <span class="va">LIKE</span>, <span class="va">SO</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function to compute percentage of texts with occurrences meeting a condition</span></span>
<span><span class="va">compute_percentage</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">condition</span>, <span class="va">threshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">numeric_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Filter</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">percentage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">condition</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">numeric_data</span>, <span class="va">is.numeric</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">percentage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">percentage</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">percentage</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Percentage"</span></span>
<span>  <span class="va">percentage</span> <span class="op">&lt;-</span> <span class="va">percentage</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Percentage</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Percentage</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">percentage</span> <span class="op">&lt;-</span> <span class="va">percentage</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Percentage</span> <span class="op">&gt;</span> <span class="va">threshold</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">percentage</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate percentage of texts with 0 occurrences of each feature</span></span>
<span><span class="va">zero_features</span> <span class="op">&lt;-</span> <span class="fu">compute_percentage</span><span class="op">(</span><span class="va">TxBcounts</span>, <span class="va">TxBcounts</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">66.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">zero_features</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   rowname Percentage
1      GTO      67.07
2     ELAB      69.30
3     MDMM      70.81
4     HGOT      73.75
5     CONC      80.48
6     DWNT      81.44
7    QUTAG      85.99
8     PGET      87.35
9     ABLE      88.87
10     URL      96.51
11     EMO      97.82
12     PRP      98.33
13     HST      99.44</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Combine low frequency features into meaningful groups whenever this makes linguistic sense</span></span>
<span><span class="va">TxBcounts</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>JJPR <span class="op">=</span> <span class="va">ABLE</span> <span class="op">+</span> <span class="va">JJPR</span>, ABLE <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>PASS <span class="op">=</span> <span class="va">PGET</span> <span class="op">+</span> <span class="va">PASS</span>, PGET <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Re-calculate percentage of texts with 0 occurrences of each feature</span></span>
<span><span class="va">zero_features</span> <span class="op">&lt;-</span> <span class="fu">compute_percentage</span><span class="op">(</span><span class="va">TxBcounts</span>, <span class="va">TxBcounts</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">66.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">zero_features</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   rowname Percentage
1      GTO      67.07
2     ELAB      69.30
3     MDMM      70.81
4     HGOT      73.75
5     CONC      80.48
6     DWNT      81.44
7    QUTAG      85.99
8      URL      96.51
9      EMO      97.82
10     PRP      98.33
11     HST      99.44</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Drop variables with low document frequency</span></span>
<span><span class="va">TxBcounts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">TxBcounts</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/one_of.html">one_of</a></span><span class="op">(</span><span class="va">zero_features</span><span class="op">$</span><span class="va">rowname</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">)</span><span class="op">-</span><span class="fl">8</span> <span class="co"># Number of linguistic features remaining</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 64</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> [1] "Filename" "Country"  "Series"   "Level"    "Register" "Words"   
 [7] "ACT"      "AMP"      "ASPECT"   "AWL"      "BEMA"     "CAUSE"   
[13] "CC"       "COMM"     "COND"     "CONT"     "CUZ"      "DEMO"    
[19] "DMA"      "DOAUX"    "DT"       "EMPH"     "EX"       "EXIST"   
[25] "FPP1P"    "FPP1S"    "FPUH"     "FREQ"     "HDG"      "IN"      
[31] "JJAT"     "JJPR"     "LD"       "MDCA"     "MDCO"     "MDNE"    
[37] "MDWO"     "MDWS"     "MENTAL"   "NCOMP"    "NN"       "OCCUR"   
[43] "PASS"     "PEAS"     "PIT"      "PLACE"    "POLITE"   "POS"     
[49] "PROG"     "QUAN"     "QUPR"     "RB"       "RP"       "SPLIT"   
[55] "SPP2"     "STPR"     "THATD"    "THRC"     "THSC"     "TIME"    
[61] "TPP3P"    "TPP3S"    "TTR"      "VBD"      "VBG"      "VBN"     
[67] "VIMP"     "VPRT"     "WHQU"     "WHSC"     "XX0"      "YNQU"    </code></pre>
</div>
</div>
</section><section id="standardising-normalised-counts-and-identifying-potential-outliers" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="standardising-normalised-counts-and-identifying-potential-outliers">
<span class="header-section-number">3.2.2</span> Standardising normalised counts and identifying potential outliers</h3>
<p>“As an alternative to removing very sparse feature, we apply a signed logarithmic transformation to deskew the feature distributions.” (Neumann &amp; Evert)</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First scale the normalised counts (z-standardisation) to be able to compare the various features</span></span>
<span><span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Words</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">keep</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">TxBzcounts</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">TxBzcounts</span>, las <span class="op">=</span> <span class="fl">3</span>, main <span class="op">=</span> <span class="st">"z-scores"</span><span class="op">)</span> <span class="co"># Slow to open!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="5a_TEC_data_prep_files/figure-html/z-standardisation-outliers-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># If necessary, remove any outliers at this stage.</span></span>
<span></span>
<span><span class="va">TxBdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">TxBzcounts</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">TxBdata</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1977</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">TxBdata</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1977 obs. of  72 variables:
 $ Filename: chr  "Achievers_A1_Instructional_0012.txt" "Solutions_Pre-Intermediate_Instructional_0023.txt" "POC_4e_Spoken_0007.txt" "Achievers_A2_Personal_0003.txt" ...
 $ Country : Factor w/ 3 levels "France","Germany",..: 3 3 1 3 3 1 2 3 2 2 ...
 $ Series  : Factor w/ 9 levels "Access","Achievers",..: 2 9 8 2 2 8 1 2 7 1 ...
 $ Level   : Factor w/ 5 levels "A","B","C","D",..: 1 2 3 2 4 2 4 4 1 1 ...
 $ Register: Factor w/ 5 levels "Conversation",..: 4 4 1 5 3 1 2 4 1 2 ...
 $ Words   : int  931 889 750 979 690 694 547 967 927 840 ...
 $ ACT     : num  -0.2569 1.5417 -0.0539 0.8188 2.531 ...
 $ AMP     : num  -0.929 -0.493 0.104 -0.533 -0.368 ...
 $ ASPECT  : num  0.2073 1.689 -0.0762 -0.6702 0.9881 ...
 $ AWL     : num  1.08 0.776 -1.218 -0.89 1.541 ...
 $ BEMA    : num  -0.984 -1.0355 0.2643 -0.0374 -0.3312 ...
 $ CAUSE   : num  -0.98019 -0.47668 -0.31353 0.29904 0.00587 ...
 $ CC      : num  -0.647 0.133 1.444 -0.136 3.627 ...
 $ COMM    : num  1.824 1.191 -0.525 -0.731 0.275 ...
 $ COND    : num  -0.1074 -0.8371 -0.1484 0.0438 -0.8371 ...
 $ CONT    : num  -0.847 -1.124 0.339 1.149 -0.815 ...
 $ CUZ     : num  -0.7024 -0.7024 0.3261 -0.0446 -0.7024 ...
 $ DEMO    : num  -0.448 -0.393 -1.039 -0.952 -1.305 ...
 $ DMA     : num  -0.564 -0.697 1.795 -0.443 -0.697 ...
 $ DOAUX   : num  0.706 0.335 -1.148 2.711 -1.495 ...
 $ DT      : num  0.0457 1.1124 0.806 -1.3939 -0.5334 ...
 $ EMPH    : num  -1.25 -0.99 0.294 0.406 -0.579 ...
 $ EX      : num  -0.579 -0.897 -0.897 0.254 -0.897 ...
 $ EXIST   : num  -0.726 -0.152 2.473 -0.287 4.154 ...
 $ FPP1P   : num  -0.788 -0.788 1.734 2.314 2.081 ...
 $ FPP1S   : num  -0.869 -0.852 2.336 1.553 -0.909 ...
 $ FPUH    : num  -0.597 -0.391 0.869 -0.41 -0.597 ...
 $ FREQ    : num  0.1757 -0.0252 -0.1645 -0.8775 -0.4375 ...
 $ HDG     : num  0.0361 -0.6537 3.6281 -0.6537 0.2769 ...
 $ IN      : num  0.366 2.282 0.283 -0.733 0.628 ...
 $ JJAT    : num  -1.192 -1.042 0.853 -1.296 2.129 ...
 $ JJPR    : num  -0.922 -0.876 -0.247 -0.12 -0.273 ...
 $ LD      : num  1.713 -0.179 -0.714 0.203 1.585 ...
 $ MDCA    : num  -0.751251 -0.274434 -0.774825 -0.15878 -0.000748 ...
 $ MDCO    : num  -0.719 -0.719 0.302 -0.719 -0.719 ...
 $ MDNE    : num  -0.88 -0.88 0.847 1.697 1.674 ...
 $ MDWO    : num  -0.38 0.181 8.472 0.415 -0.683 ...
 $ MDWS    : num  -0.201 -0.667 0.212 -0.105 2.583 ...
 $ MENTAL  : num  0.356 -0.107 1.626 0.746 -0.157 ...
 $ NCOMP   : num  0.528 -0.906 -0.621 3.722 2.299 ...
 $ NN      : num  0.47 0.741 -0.996 -0.509 1.432 ...
 $ OCCUR   : num  -0.627 0.371 1.943 -0.931 -0.931 ...
 $ PASS    : num  -0.607 -0.293 -0.136 -0.367 0.171 ...
 $ PEAS    : num  -0.858 -0.858 -0.858 -0.627 0.212 ...
 $ PIT     : num  -1.253 -1.505 -0.318 0.468 0.601 ...
 $ PLACE   : num  -0.802 -0.371 -1.035 0.371 0.916 ...
 $ POLITE  : num  -0.5 -0.5 0.742 0.451 -0.5 ...
 $ POS     : num  0.191 -1.304 -1.304 -1.304 -0.632 ...
 $ PROG    : num  0.5597 -0.0602 -0.1744 1.1647 0.8727 ...
 $ QUAN    : num  -1.03058 -0.00848 1.56447 0.33431 -0.80474 ...
 $ QUPR    : num  -0.679 -1.011 1.496 -0.61 0.843 ...
 $ RB      : num  -0.716 -1.646 -0.22 0.379 -1.157 ...
 $ RP      : num  -1.205 0.727 0.33 -0.877 1.065 ...
 $ SPLIT   : num  -0.89 -0.89 -0.242 -0.475 1.028 ...
 $ SPP2    : num  0.156 0.557 0.161 0.553 0.798 ...
 $ STPR    : num  -0.249 1.604 0.253 1.234 -0.815 ...
 $ THATD   : num  1.748 -1.041 -1.041 0.883 -1.041 ...
 $ THRC    : num  -0.685 -0.685 -0.685 -0.685 -0.685 ...
 $ THSC    : num  -0.348 -0.121 -0.882 -0.56 -0.137 ...
 $ TIME    : num  -0.4164 -0.6909 0.4315 0.0699 -0.7051 ...
 $ TPP3P   : num  -0.294 -0.558 -1.215 -0.937 0.715 ...
 $ TPP3S   : num  -0.596 -0.32 -0.769 -0.807 -0.874 ...
 $ TTR     : num  -0.92586 -0.31359 0.91095 -0.00745 2.3979 ...
 $ VBD     : num  -0.951 -0.594 0.662 -0.858 -0.189 ...
 $ VBG     : num  -0.959 0.875 0.208 0.907 1.607 ...
 $ VBN     : num  -0.818 0.376 -0.818 -0.818 0.741 ...
 $ VIMP    : num  1.963 1.658 -0.703 -0.539 -0.542 ...
 $ VPRT    : num  -0.635 -0.796 -1.059 1.438 0.34 ...
 $ WHQU    : num  1.4997 0.8327 0.0894 0.54 -1.0783 ...
 $ WHSC    : num  -0.569 -0.375 -0.5 -0.84 1.346 ...
 $ XX0     : num  -1.049 -0.667 -0.14 0.233 -0.684 ...
 $ YNQU    : num  -0.1051 1.1592 0.4093 0.0709 -1.037 ...</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">outliers</span> <span class="op">&lt;-</span> <span class="va">TxBdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Words</span>, <span class="va">LD</span>, <span class="va">TTR</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">if_any</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="op">~</span> <span class="va">.x</span> <span class="op">&gt;</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Filename</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outliers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                                            Filename
1                             POC_4e_Spoken_0007.txt
2             Solutions_Elementary_Personal_0001.txt
3                       NGL_5_Instructional_0018.txt
4                           Access_1_Spoken_0011.txt
5                              EIM_1_Spoken_0012.txt
6                              NGL_4_Spoken_0011.txt
7      Solutions_Intermediate_Plus_Personal_0001.txt
8           Solutions_Elementary_ELF_Spoken_0021.txt
9                          NB_2_Informative_0009.txt
10       Solutions_Intermediate_Plus_Spoken_0022.txt
11     Solutions_Intermediate_Instructional_0025.txt
12 Solutions_Pre-Intermediate_Instructional_0024.txt
13                            POC_4e_Spoken_0010.txt
14            Solutions_Intermediate_Spoken_0019.txt
15                          Access_1_Spoken_0019.txt
16    Solutions_Pre-Intermediate_ELF_Spoken_0005.txt</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TxBcounts</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">Filename</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">outliers</span><span class="op">$</span><span class="va">Filename</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">TxBcounts</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1961</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Words</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">keep</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">TxBzcounts</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">TxBzcounts</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1961</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">TxBzcounts</span>, las <span class="op">=</span> <span class="fl">3</span>, main <span class="op">=</span> <span class="st">"z-scores"</span><span class="op">)</span> <span class="co"># Slow to open!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="5a_TEC_data_prep_files/figure-html/z-standardisation-outliers-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#saveRDS(TxBcounts, here("processed_data", "TxBcounts3.rds")) # Last saved 16 Feb 2024</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TxBzcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># This function from tidyr converts a selection of variables into two variables: a key and a value. The key contains the names of the original variable and the value the data. This means we can then use the facet_wrap function from ggplot2</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">key</span>, scales <span class="op">=</span> <span class="st">"free"</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, colour<span class="op">=</span> <span class="st">"darkred"</span>, fill <span class="op">=</span> <span class="st">"darkred"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="5a_TEC_data_prep_files/figure-html/z-transformed-distributions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#ggsave(here("plots", "TEC-zscores-HistogramsAllVariablesTEC-only.svg"), width = 20, height = 45)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="transforming-the-features-to-partially-deskew-these-distributions" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="transforming-the-features-to-partially-deskew-these-distributions">
<span class="header-section-number">3.2.3</span> Transforming the features to (partially) deskew these distributions</h3>
<p>Signed log transformation function inspired by the SignedLog function proposed in https://cran.r-project.org/web/packages/DataVisualizations/DataVisualizations.pdf</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># All features are signed log-transformed (this is also what Neumann &amp; Evert 2021 do)</span></span>
<span><span class="va">signed.log</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="va">TxBzlogcounts</span> <span class="op">&lt;-</span> <span class="fu">signed.log</span><span class="op">(</span><span class="va">TxBzcounts</span><span class="op">)</span> <span class="co"># Standardise first, then signed log transform</span></span>
<span></span>
<span><span class="co"># The function above would only transform the most skewed variables. This is what Lee suggests doing but it makes the interpretation of the correlations quite tricky so I abandoned this idea.</span></span>
<span><span class="co"># TxBzlogcounts2 &lt;- TxBzcounts %&gt;%</span></span>
<span><span class="co">#   as.data.frame() %&gt;% </span></span>
<span><span class="co">#     mutate(across(.cols = c(AMP, ASPECT, CAUSE, COND, CUZ, DMA, EMPH, EX, EXIST, FPP1P, FPP1S, FPUH, FREQ, HDG, MDCA, MDCO, MDNE, MDWO, MDWS, OCCUR, PASS, PEAS, PLACE, POLITE, PROG, QUPR, RP, SPLIT, STPR, THATD, THRC, THSC, TPP3P, TPP3S, VBD, VBG, VBN, VIMP, WHQU, WHSC, YNQU),</span></span>
<span><span class="co">#         .fns = signed.log)) %&gt;% </span></span>
<span><span class="co">#     rename_with(.cols = c(AMP, ASPECT, CAUSE, COND, CUZ, DMA, EMPH, EX, EXIST, FPP1P, FPP1S, FPUH, FREQ, HDG, MDCA, MDCO, MDNE, MDWO, MDWS, OCCUR, PASS, PEAS, PLACE, POLITE, PROG, QUPR, RP, SPLIT, STPR, THATD, THRC, THSC, TPP3P, TPP3S, VBD, VBG, VBN, VIMP, WHQU, WHSC, YNQU),</span></span>
<span><span class="co">#                 .fn = ~paste0(., '_signedlog'))</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">TxBzlogcounts</span>, las<span class="op">=</span><span class="fl">3</span>, main<span class="op">=</span><span class="st">"log-transformed z-scores"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="5a_TEC_data_prep_files/figure-html/signed.log.transformation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#saveRDS(TxBzlogcounts, here("processed_data", "TxBzlogcounts.rds")) # Last saved 16 Feb 2024</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TxBzlogcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># This function from tidyr converts a selection of variables into two variables: a key and a value. The key contains the names of the original variable and the value the data. This means we can then use the facet_wrap function from ggplot2</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">value</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">key</span>, scales <span class="op">=</span> <span class="st">"free"</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, colour<span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"darkred"</span>, weight <span class="op">=</span> <span class="fl">2</span>, fill<span class="op">=</span><span class="st">"darkred"</span>, alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="5a_TEC_data_prep_files/figure-html/signed.log.transformation-distributions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#ggsave(here("plots", "DensityPlotsAllVariablesSignedLog-TEC-only.svg"), width = 15, height = 49)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>These plots serve to illustrate the effects of the variable transformations performed in the above chunks.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This is a slightly amended version of the PerformanceAnalytics::chart.Correlation() function. It simply removes the significance stars that are meaningless with this many data points (see commented out lines below)</span></span>
<span></span>
<span><span class="va">chart.Correlation.nostars</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">R</span>, <span class="va">histogram</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">method</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, <span class="st">"kendall"</span>, <span class="st">"spearman"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/PerformanceAnalytics/man/checkData.html">checkData</a></span><span class="op">(</span><span class="va">R</span>, method <span class="op">=</span> <span class="st">"matrix"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">method</span><span class="op">)</span><span class="op">)</span> </span>
<span>    <span class="va">method</span> <span class="op">=</span> <span class="va">method</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">panel.cor</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">2</span>, <span class="va">prefix</span> <span class="op">=</span> <span class="st">""</span>, <span class="va">use</span> <span class="op">=</span> <span class="st">"pairwise.complete.obs"</span>, <span class="va">method</span> <span class="op">=</span> <span class="st">"pearson"</span>, <span class="va">cex.cor</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">usr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="st">"usr"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">usr</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>usr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, use <span class="op">=</span> <span class="va">use</span>, method <span class="op">=</span> <span class="va">method</span><span class="op">)</span></span>
<span>    <span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">r</span>, <span class="fl">0.123456789</span><span class="op">)</span>, digits <span class="op">=</span> <span class="va">digits</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="va">txt</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">cex.cor</span><span class="op">)</span><span class="op">)</span> </span>
<span>      <span class="va">cex</span> <span class="op">&lt;-</span> <span class="fl">0.8</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/graphics/strwidth.html">strwidth</a></span><span class="op">(</span><span class="va">txt</span><span class="op">)</span></span>
<span>    <span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, method <span class="op">=</span> <span class="va">method</span><span class="op">)</span></span>
<span>    <span class="co"># Signif &lt;- symnum(test$p.value, corr = FALSE, na = FALSE, </span></span>
<span>    <span class="co">#                  cutpoints = c(0, 0.001, 0.01, 0.05, 0.1, 1), symbols = c("***", </span></span>
<span>    <span class="co">#                                                                           "**", "*", ".", " "))</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="va">txt</span>, cex <span class="op">=</span> <span class="va">cex</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">/</span><span class="fl">1.3</span><span class="op">)</span></span>
<span>    <span class="co"># text(0.8, 0.8, Signif, cex = cex, col = 2)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">t</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu">sd.xts</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">dotargs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">dotargs</span><span class="op">$</span><span class="va">method</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">method</span><span class="op">)</span></span>
<span>  <span class="va">hist.panel</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">x</span>, col <span class="op">=</span> <span class="st">"light gray"</span>, probability <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         axes <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="st">""</span>, breaks <span class="op">=</span> <span class="st">"FD"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/rug.html">rug</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">histogram</span><span class="op">)</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span><span class="op">(</span><span class="va">x</span>, gap <span class="op">=</span> <span class="fl">0</span>, lower.panel <span class="op">=</span> <span class="va">panel.smooth</span>, upper.panel <span class="op">=</span> <span class="va">panel.cor</span>, </span>
<span>          diag.panel <span class="op">=</span> <span class="va">hist.panel</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span><span class="op">(</span><span class="va">x</span>, gap <span class="op">=</span> <span class="fl">0</span>, lower.panel <span class="op">=</span> <span class="va">panel.smooth</span>, upper.panel <span class="op">=</span> <span class="va">panel.cor</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example plot without any variable transformation</span></span>
<span><span class="va">example1</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">NN</span>,<span class="va">PROG</span>,<span class="va">SPLIT</span>,<span class="va">ACT</span>,<span class="va">FPP1S</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#png(here("plots", "CorrChart-TEC-examples-normedcounts.png"), width = 20, height = 20, units = "cm", res = 300)</span></span>
<span><span class="fu">chart.Correlation.nostars</span><span class="op">(</span><span class="va">example1</span>, histogram<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="5a_TEC_data_prep_files/figure-html/example-correlation-plots-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>null device 
          1 </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Example plot with transformed variables</span></span>
<span><span class="va">example2</span> <span class="op">&lt;-</span> <span class="va">TxBzlogcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">NN</span>,<span class="va">PROG</span>,<span class="va">SPLIT</span>,<span class="va">ACT</span>,<span class="va">FPP1S</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#png(here("plots", "CorrChart-TEC-examples-zsignedlogcounts.png"), width = 20, height = 20, units = "cm", res = 300)</span></span>
<span><span class="fu">chart.Correlation.nostars</span><span class="op">(</span><span class="va">example2</span>, histogram<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>null device 
          1 </code></pre>
</div>
</div>
</section><section id="visualisation-of-feature-correlations" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="visualisation-of-feature-correlations">
<span class="header-section-number">3.2.4</span> Visualisation of feature correlations</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Simple heatmap in base R (inspired by Stephanie Evert's SIGIL code)</span></span>
<span><span class="va">cor.colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/hsv.html">hsv</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">2</span><span class="op">/</span><span class="fl">3</span>, v<span class="op">=</span><span class="fl">1</span>, s<span class="op">=</span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span>, <span class="co"># blue = negative correlation </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="co"># white = no correlation </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/hsv.html">hsv</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, v<span class="op">=</span><span class="fl">1</span>, s<span class="op">=</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># red = positive correlation</span></span>
<span></span>
<span><span class="co">#png(here("plots", "heatmapzlogcounts-TEC-only.png"), width = 30, height= 30, units = "cm", res = 300)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html">heatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">TxBzlogcounts</span><span class="op">)</span>, </span>
<span>        symm<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>        zlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, </span>
<span>        col<span class="op">=</span><span class="va">cor.colours</span>, </span>
<span>        margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="5a_TEC_data_prep_files/figure-html/heatmap-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="composition-of-tec-textsfiles-entered-in-the-mdas" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="composition-of-tec-textsfiles-entered-in-the-mdas">
<span class="header-section-number">3.3</span> Composition of TEC texts/files entered in the MDAs</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Total number of words</span></span>
<span><span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Words</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  sum(Words)
1    1693650</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Filename</span>, <span class="va">Country</span>, <span class="va">Series</span>, <span class="va">Level</span>, <span class="va">Register</span>, <span class="va">Words</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Series</span>, <span class="va">Level</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Volume <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">Volume</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Volume <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">Volume</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Level</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Volume</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>wordcount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Words</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Volume</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot for book</span></span>
<span><span class="va">metadata2</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Series</span>, <span class="va">Level</span>, <span class="va">Register</span>, <span class="va">Words</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Series</span>, <span class="va">Level</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Volume <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">Volume</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">#mutate(Volume = fct_reorder(Volume, as.numeric(Level))) %&gt;% </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Volume</span>, <span class="va">Register</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>wordcount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Words</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Volume</span>, <span class="va">Register</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This is the palette created above on the basis of the suffrager pakcage (but without needed to install the package)</span></span>
<span><span class="va">palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#BD241E"</span>, <span class="st">"#A18A33"</span>, <span class="st">"#15274D"</span>, <span class="st">"#D54E1E"</span>, <span class="st">"#EA7E1E"</span>, <span class="st">"#4C4C4C"</span>, <span class="st">"#722672"</span>, <span class="st">"#F9B921"</span>, <span class="st">"#267226"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">PlotSp</span> <span class="op">&lt;-</span> <span class="va">metadata2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span><span class="op">==</span><span class="st">"Spain"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">#arrange(Volume) %&gt;% </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Volume</span>, y <span class="op">=</span> <span class="va">wordcount</span>, fill <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">Register</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Removes those annoying ticks before each bar label</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Spain"</span>, y <span class="op">=</span> <span class="st">"Cumulative word count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                      guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">PlotGer</span> <span class="op">&lt;-</span> <span class="va">metadata2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span><span class="op">==</span><span class="st">"Germany"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">#arrange(Volume) %&gt;% </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Volume</span>, y <span class="op">=</span> <span class="va">wordcount</span>, fill <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">Register</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Germany"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">PlotFr</span> <span class="op">&lt;-</span> <span class="va">metadata2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span><span class="op">==</span><span class="st">"France"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">#arrange(Volume) %&gt;% </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Volume</span>, y <span class="op">=</span> <span class="va">wordcount</span>, fill <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">Register</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"France"</span>, y  <span class="op">=</span> <span class="st">""</span>, fill <span class="op">=</span> <span class="st">"Register subcorpus"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span>, legend.hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.justification <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">PlotFr</span> <span class="op">/</span></span>
<span><span class="va">PlotGer</span> <span class="op">/</span></span>
<span><span class="va">PlotSp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="5a_TEC_data_prep_files/figure-html/TEC-metadata-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#ggsave(here("plots", "TEC-T_wordcounts_book.svg"), width = 8, height = 12)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Meta-data on % of instructional language in each textbook</span></span>
<span><span class="va">metadataInstr</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Series</span>, <span class="va">Level</span>, <span class="va">Register</span>, <span class="va">Words</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Register</span><span class="op">==</span><span class="st">"Instructional"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Series</span>, <span class="va">Register</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Volume <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">Volume</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Volume <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">Volume</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Level</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Volume</span>, <span class="va">Register</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>InstrWordcount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Words</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Volume</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Series</span>, <span class="va">InstrWordcount</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadataInstr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  Series    InstrWordcount
  &lt;fct&gt;              &lt;int&gt;
1 Achievers         109886
2 Solutions          87829
3 EIM                59928
4 HT                 51550
5 Access             60938
6 NGL                79312
7 JTT                48375
8 GreenLine          54263
9 POC                30548</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">metaWordcount</span> <span class="op">&lt;-</span> <span class="va">TxBcounts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Series</span>, <span class="va">Level</span>, <span class="va">Register</span>, <span class="va">Words</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Series</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>TECwordcount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Words</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Series</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Series</span>, <span class="va">TECwordcount</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wordcount</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">metaWordcount</span>, <span class="va">metadataInstr</span>, by <span class="op">=</span> <span class="st">"Series"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wordcount</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>InstrucPercent <span class="op">=</span> <span class="va">InstrWordcount</span><span class="op">/</span><span class="va">TECwordcount</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">InstrucPercent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>InstrucPercent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">InstrucPercent</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     Series TECwordcount InstrWordcount InstrucPercent
1    Access       259679          60938          23.47
2       NGL       278316          79312          28.50
3 GreenLine       172267          54263          31.50
4 Solutions       270278          87829          32.50
5       JTT       137557          48375          35.17
6        HT       142676          51550          36.13
7       POC        76714          30548          39.82
8       EIM       147185          59928          40.72
9 Achievers       208978         109886          52.58</code></pre>
</div>
</div>
</section></section><section id="packages-used-in-this-script" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Packages used in this script</h1>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link  aria-label=">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./summary.html" class="pagination-link" aria-label="<span class='chapter-number'>3</span>&nbsp; <span class='chapter-title'>Summary</span>">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Summary</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb76" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>This document outlines the steps taken to pre-process the Textbook English Corpus (TEC) data.</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co">#renv::restore() # Restore the project's dependencies from the lockfile to ensure that same package versions are used as in the original thesis.</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) <span class="co"># For its confusion matrix function</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># For dynamic file paths</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># For Fig. 1</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PerformanceAnalytics)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych) <span class="co"># For various useful stats function</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data import from MFTE output</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: TxBcounts</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Textbook Corpus data</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a><span class="co"># This .tsv file corresponds to the "mixed normalised frequency" output of the MFTE Perl v. 3.1</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="fu">here</span>(<span class="st">"MFTE_data"</span>, <span class="st">"Outputs"</span>, <span class="st">"TxB900MDA_3.1_normed_complex_counts.tsv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Filename<span class="sc">!=</span><span class="st">".DS_Store"</span>) <span class="sc">%&gt;%</span> <span class="fu">droplevels</span>(.)</span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(TxBcounts) <span class="co"># Check sanity of data</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(TxBcounts) <span class="co"># Should be 2014 files</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding a textbook proficiency level</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>TxBLevels <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="fu">here</span>(<span class="st">"metadata"</span>, <span class="st">"TxB900MDA_ProficiencyLevels.csv"</span>), <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="ot">&lt;-</span> <span class="fu">full_join</span>(TxBcounts, TxBLevels, <span class="at">by =</span> <span class="st">"Filename"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Level =</span> <span class="fu">as.factor</span>(Level)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Filename =</span> <span class="fu">as.factor</span>(Filename))</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(TxBcounts<span class="sc">$</span>Level) <span class="co"># Check distribution and that there are no NAs</span></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="sc">%&gt;%</span> <span class="fu">select</span>(Filename, Level) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">20</span>) <span class="co"># Check matching on random sample</span></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding a register variable from the file names</span></span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>TxBcounts<span class="sc">$</span>Register <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(stringr<span class="sc">::</span><span class="fu">str_extract</span>(TxBcounts<span class="sc">$</span>Filename, <span class="st">"Spoken|Narrative|Other|Personal|Informative|Instructional|Poetry"</span>)) <span class="co"># Add a variable for Textbook Register</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(TxBcounts<span class="sc">$</span>Register)</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>TxBcounts<span class="sc">$</span>Register <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(TxBcounts<span class="sc">$</span>Register, <span class="st">"'Narrative' = 'Fiction'; 'Spoken' = 'Conversation'"</span>)</span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(TxBcounts) <span class="co"># Check all the variables make sense</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding a textbook series variable from the file names</span></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>TxBcounts<span class="sc">$</span>Filename <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(TxBcounts<span class="sc">$</span>Filename, <span class="st">"English_In_Mind|English_in_Mind"</span>, <span class="st">"EIM"</span>) </span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a>TxBcounts<span class="sc">$</span>Filename <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(TxBcounts<span class="sc">$</span>Filename, <span class="st">"New_GreenLine"</span>, <span class="st">"NGL"</span>) <span class="co"># Otherwise the regex for GreenLine will override New_GreenLine</span></span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a>TxBcounts<span class="sc">$</span>Filename <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(TxBcounts<span class="sc">$</span>Filename, <span class="st">"Piece_of_cake"</span>, <span class="st">"POC"</span>) <span class="co"># Shorten label for ease of plotting</span></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a>TxBcounts<span class="sc">$</span>Series <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(stringr<span class="sc">::</span><span class="fu">str_extract</span>(TxBcounts<span class="sc">$</span>Filename, <span class="st">"Access|Achievers|EIM|GreenLine|HT|NB|NM|POC|JTT|NGL|Solutions"</span>))</span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(TxBcounts<span class="sc">$</span>Series) <span class="co"># Extract textbook series from (ammended) filenames</span></span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Including the French textbooks for the first year of Lycée to their corresponding publisher series from collège</span></span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a>TxBcounts<span class="sc">$</span>Series <span class="ot">&lt;-</span>car<span class="sc">::</span><span class="fu">recode</span>(TxBcounts<span class="sc">$</span>Series, <span class="st">"c('NB', 'JTT') = 'JTT'; c('NM', 'HT') = 'HT'"</span>) <span class="co"># # Recode final volumes of French series (see Section 4.3.1.1 on textbook selection for details)</span></span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(TxBcounts<span class="sc">$</span>Series)</span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding a textbook country of use variable from the series variable</span></span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a>TxBcounts<span class="sc">$</span>Country <span class="ot">&lt;-</span> TxBcounts<span class="sc">$</span>Series</span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true" tabindex="-1"></a>TxBcounts<span class="sc">$</span>Country <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(TxBcounts<span class="sc">$</span>Series, <span class="st">"c('Access', 'GreenLine', 'NGL') = 'Germany'; c('Achievers', 'EIM', 'Solutions') = 'Spain'; c('HT', 'NB', 'NM', 'POC', 'JTT') = 'France'"</span>)</span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(TxBcounts<span class="sc">$</span>Country)</span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-order variables</span></span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(TxBcounts)</span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span> </span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">order</span>(<span class="fu">names</span>(.))) <span class="sc">%&gt;%</span> <span class="co"># Order alphabetically first</span></span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Filename, Country, Series, Level, Register, Words, <span class="fu">everything</span>())</span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-68"><a href="#cb76-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-69"><a href="#cb76-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary statistics</span></span>
<span id="cb76-70"><a href="#cb76-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-73"><a href="#cb76-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-74"><a href="#cb76-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: TEC-summary-stats</span></span>
<span id="cb76-75"><a href="#cb76-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-76"><a href="#cb76-76" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="sc">%&gt;%</span> </span>
<span id="cb76-77"><a href="#cb76-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Register) <span class="sc">%&gt;%</span> </span>
<span id="cb76-78"><a href="#cb76-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">totaltexts =</span> <span class="fu">n</span>(), <span class="at">totalwords =</span> <span class="fu">sum</span>(Words), <span class="at">mean =</span> <span class="fu">as.integer</span>(<span class="fu">mean</span>(Words)), <span class="at">sd =</span> <span class="fu">as.integer</span>(<span class="fu">sd</span>(Words)), <span class="at">TTRmean =</span> <span class="fu">mean</span>(TTR))</span>
<span id="cb76-79"><a href="#cb76-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-80"><a href="#cb76-80" aria-hidden="true" tabindex="-1"></a><span class="co">#TxBcounts &lt;- saveRDS(TxBcounts, here("processed_data", "TxBcounts.rds"))</span></span>
<span id="cb76-81"><a href="#cb76-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-82"><a href="#cb76-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-83"><a href="#cb76-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-84"><a href="#cb76-84" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data preparation for PCA</span></span>
<span id="cb76-85"><a href="#cb76-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-86"><a href="#cb76-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## Removal of Poetry texts</span></span>
<span id="cb76-87"><a href="#cb76-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-90"><a href="#cb76-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-91"><a href="#cb76-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Poetry-removal</span></span>
<span id="cb76-92"><a href="#cb76-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-93"><a href="#cb76-93" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(TxBcounts)</span>
<span id="cb76-94"><a href="#cb76-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-95"><a href="#cb76-95" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span> </span>
<span id="cb76-96"><a href="#cb76-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Register<span class="sc">!=</span><span class="st">"Poetry"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-97"><a href="#cb76-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>(.)</span>
<span id="cb76-98"><a href="#cb76-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-99"><a href="#cb76-99" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(TxBcounts)</span>
<span id="cb76-100"><a href="#cb76-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-101"><a href="#cb76-101" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(TxBcounts<span class="sc">$</span>Register)</span>
<span id="cb76-102"><a href="#cb76-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-103"><a href="#cb76-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-104"><a href="#cb76-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-105"><a href="#cb76-105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Feature distributions</span></span>
<span id="cb76-106"><a href="#cb76-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-109"><a href="#cb76-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-110"><a href="#cb76-110" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: distribution-viz</span></span>
<span id="cb76-111"><a href="#cb76-111" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 40</span></span>
<span id="cb76-112"><a href="#cb76-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-113"><a href="#cb76-113" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="sc">%&gt;%</span></span>
<span id="cb76-114"><a href="#cb76-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Words) <span class="sc">%&gt;%</span> </span>
<span id="cb76-115"><a href="#cb76-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(is.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb76-116"><a href="#cb76-116" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">gather</span>() <span class="sc">%&gt;%</span> <span class="co"># This function from tidyr converts a selection of variables into two variables: a key and a value. The key contains the names of the original variable and the value the data. This means we can then use the facet_wrap function from ggplot2</span></span>
<span id="cb76-117"><a href="#cb76-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(value)) <span class="sc">+</span></span>
<span id="cb76-118"><a href="#cb76-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb76-119"><a href="#cb76-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> key, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb76-120"><a href="#cb76-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb76-121"><a href="#cb76-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">colour=</span> <span class="st">"darkred"</span>, <span class="at">fill =</span> <span class="st">"darkred"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb76-122"><a href="#cb76-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-123"><a href="#cb76-123" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(here("plots", "TEC-HistogramPlotsAllVariablesTEC-only.svg"), width = 20, height = 45)</span></span>
<span id="cb76-124"><a href="#cb76-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-125"><a href="#cb76-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-126"><a href="#cb76-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-127"><a href="#cb76-127" aria-hidden="true" tabindex="-1"></a><span class="fu">### Feature removal I</span></span>
<span id="cb76-128"><a href="#cb76-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-131"><a href="#cb76-131" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-132"><a href="#cb76-132" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: feature-removal</span></span>
<span id="cb76-133"><a href="#cb76-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-134"><a href="#cb76-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Removal of meaningless features:</span></span>
<span id="cb76-135"><a href="#cb76-135" aria-hidden="true" tabindex="-1"></a><span class="co"># CD because numbers as digits were mostly removed from the textbooks</span></span>
<span id="cb76-136"><a href="#cb76-136" aria-hidden="true" tabindex="-1"></a><span class="co"># LIKE and SO because they are "bin" features designed to ensure that the counts for these two words don't inflate other categories due to mistags.</span></span>
<span id="cb76-137"><a href="#cb76-137" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span> </span>
<span id="cb76-138"><a href="#cb76-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(CD, LIKE, SO))</span>
<span id="cb76-139"><a href="#cb76-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-140"><a href="#cb76-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute percentage of texts with occurrences meeting a condition</span></span>
<span id="cb76-141"><a href="#cb76-141" aria-hidden="true" tabindex="-1"></a>compute_percentage <span class="ot">&lt;-</span> <span class="cf">function</span>(data, condition, threshold) {</span>
<span id="cb76-142"><a href="#cb76-142" aria-hidden="true" tabindex="-1"></a>  numeric_data <span class="ot">&lt;-</span> <span class="fu">Filter</span>(is.numeric, data)</span>
<span id="cb76-143"><a href="#cb76-143" aria-hidden="true" tabindex="-1"></a>  percentage <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">colSums</span>(condition[, <span class="fu">sapply</span>(numeric_data, is.numeric)])<span class="sc">/</span><span class="fu">nrow</span>(data) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb76-144"><a href="#cb76-144" aria-hidden="true" tabindex="-1"></a>  percentage <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(percentage)</span>
<span id="cb76-145"><a href="#cb76-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(percentage) <span class="ot">&lt;-</span> <span class="st">"Percentage"</span></span>
<span id="cb76-146"><a href="#cb76-146" aria-hidden="true" tabindex="-1"></a>  percentage <span class="ot">&lt;-</span> percentage <span class="sc">%&gt;%</span> </span>
<span id="cb76-147"><a href="#cb76-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Percentage)) <span class="sc">%&gt;%</span></span>
<span id="cb76-148"><a href="#cb76-148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-149"><a href="#cb76-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(Percentage)</span>
<span id="cb76-150"><a href="#cb76-150" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">missing</span>(threshold)) {</span>
<span id="cb76-151"><a href="#cb76-151" aria-hidden="true" tabindex="-1"></a>    percentage <span class="ot">&lt;-</span> percentage <span class="sc">%&gt;%</span> </span>
<span id="cb76-152"><a href="#cb76-152" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(Percentage <span class="sc">&gt;</span> threshold)</span>
<span id="cb76-153"><a href="#cb76-153" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-154"><a href="#cb76-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(percentage)</span>
<span id="cb76-155"><a href="#cb76-155" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-156"><a href="#cb76-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-157"><a href="#cb76-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentage of texts with 0 occurrences of each feature</span></span>
<span id="cb76-158"><a href="#cb76-158" aria-hidden="true" tabindex="-1"></a>zero_features <span class="ot">&lt;-</span> <span class="fu">compute_percentage</span>(TxBcounts, TxBcounts <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">66.6</span>)</span>
<span id="cb76-159"><a href="#cb76-159" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(zero_features)</span>
<span id="cb76-160"><a href="#cb76-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-161"><a href="#cb76-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine low frequency features into meaningful groups whenever this makes linguistic sense</span></span>
<span id="cb76-162"><a href="#cb76-162" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span> </span>
<span id="cb76-163"><a href="#cb76-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">JJPR =</span> ABLE <span class="sc">+</span> JJPR, <span class="at">ABLE =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-164"><a href="#cb76-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PASS =</span> PGET <span class="sc">+</span> PASS, <span class="at">PGET =</span> <span class="cn">NULL</span>)</span>
<span id="cb76-165"><a href="#cb76-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-166"><a href="#cb76-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-calculate percentage of texts with 0 occurrences of each feature</span></span>
<span id="cb76-167"><a href="#cb76-167" aria-hidden="true" tabindex="-1"></a>zero_features <span class="ot">&lt;-</span> <span class="fu">compute_percentage</span>(TxBcounts, TxBcounts <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">66.6</span>)</span>
<span id="cb76-168"><a href="#cb76-168" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(zero_features)</span>
<span id="cb76-169"><a href="#cb76-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-170"><a href="#cb76-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop variables with low document frequency</span></span>
<span id="cb76-171"><a href="#cb76-171" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="ot">&lt;-</span> <span class="fu">select</span>(TxBcounts, <span class="sc">-</span><span class="fu">one_of</span>(zero_features<span class="sc">$</span>rowname))</span>
<span id="cb76-172"><a href="#cb76-172" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(TxBcounts)<span class="sc">-</span><span class="dv">8</span> <span class="co"># Number of linguistic features remaining</span></span>
<span id="cb76-173"><a href="#cb76-173" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(TxBcounts)</span>
<span id="cb76-174"><a href="#cb76-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-175"><a href="#cb76-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-176"><a href="#cb76-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-177"><a href="#cb76-177" aria-hidden="true" tabindex="-1"></a><span class="fu">### Standardising normalised counts and identifying potential outliers</span></span>
<span id="cb76-178"><a href="#cb76-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-179"><a href="#cb76-179" aria-hidden="true" tabindex="-1"></a>"As an alternative to removing very sparse feature, we apply a signed logarithmic transformation to deskew the feature distributions." (Neumann &amp; Evert)</span>
<span id="cb76-180"><a href="#cb76-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-183"><a href="#cb76-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-184"><a href="#cb76-184" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: z-standardisation-outliers</span></span>
<span id="cb76-185"><a href="#cb76-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-186"><a href="#cb76-186" aria-hidden="true" tabindex="-1"></a><span class="co"># First scale the normalised counts (z-standardisation) to be able to compare the various features</span></span>
<span id="cb76-187"><a href="#cb76-187" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="sc">%&gt;%</span></span>
<span id="cb76-188"><a href="#cb76-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Words) <span class="sc">%&gt;%</span> </span>
<span id="cb76-189"><a href="#cb76-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(is.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb76-190"><a href="#cb76-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>() <span class="ot">-&gt;</span></span>
<span id="cb76-191"><a href="#cb76-191" aria-hidden="true" tabindex="-1"></a>  TxBzcounts</span>
<span id="cb76-192"><a href="#cb76-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-193"><a href="#cb76-193" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(TxBzcounts, <span class="at">las =</span> <span class="dv">3</span>, <span class="at">main =</span> <span class="st">"z-scores"</span>) <span class="co"># Slow to open!</span></span>
<span id="cb76-194"><a href="#cb76-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-195"><a href="#cb76-195" aria-hidden="true" tabindex="-1"></a><span class="co"># If necessary, remove any outliers at this stage.</span></span>
<span id="cb76-196"><a href="#cb76-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-197"><a href="#cb76-197" aria-hidden="true" tabindex="-1"></a>TxBdata <span class="ot">&lt;-</span> <span class="fu">cbind</span>(TxBcounts[,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>], <span class="fu">as.data.frame</span>(TxBzcounts))</span>
<span id="cb76-198"><a href="#cb76-198" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(TxBdata)</span>
<span id="cb76-199"><a href="#cb76-199" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(TxBdata)</span>
<span id="cb76-200"><a href="#cb76-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-201"><a href="#cb76-201" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> TxBdata <span class="sc">%&gt;%</span> </span>
<span id="cb76-202"><a href="#cb76-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Words, LD, TTR)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-203"><a href="#cb76-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">if_any</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> .x <span class="sc">&gt;</span> <span class="dv">8</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-204"><a href="#cb76-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Filename)</span>
<span id="cb76-205"><a href="#cb76-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-206"><a href="#cb76-206" aria-hidden="true" tabindex="-1"></a>outliers</span>
<span id="cb76-207"><a href="#cb76-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-208"><a href="#cb76-208" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span> </span>
<span id="cb76-209"><a href="#cb76-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>Filename <span class="sc">%in%</span> outliers<span class="sc">$</span>Filename)</span>
<span id="cb76-210"><a href="#cb76-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-211"><a href="#cb76-211" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(TxBcounts)</span>
<span id="cb76-212"><a href="#cb76-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-213"><a href="#cb76-213" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="sc">%&gt;%</span></span>
<span id="cb76-214"><a href="#cb76-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Words) <span class="sc">%&gt;%</span> </span>
<span id="cb76-215"><a href="#cb76-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(is.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb76-216"><a href="#cb76-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>() <span class="ot">-&gt;</span></span>
<span id="cb76-217"><a href="#cb76-217" aria-hidden="true" tabindex="-1"></a>  TxBzcounts</span>
<span id="cb76-218"><a href="#cb76-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-219"><a href="#cb76-219" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(TxBzcounts)</span>
<span id="cb76-220"><a href="#cb76-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-221"><a href="#cb76-221" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(TxBzcounts, <span class="at">las =</span> <span class="dv">3</span>, <span class="at">main =</span> <span class="st">"z-scores"</span>) <span class="co"># Slow to open!</span></span>
<span id="cb76-222"><a href="#cb76-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-223"><a href="#cb76-223" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(TxBcounts, here("processed_data", "TxBcounts3.rds")) # Last saved 16 Feb 2024</span></span>
<span id="cb76-224"><a href="#cb76-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-225"><a href="#cb76-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-226"><a href="#cb76-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-229"><a href="#cb76-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-230"><a href="#cb76-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: z-transformed-distributions</span></span>
<span id="cb76-231"><a href="#cb76-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 40</span></span>
<span id="cb76-232"><a href="#cb76-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-233"><a href="#cb76-233" aria-hidden="true" tabindex="-1"></a>TxBzcounts <span class="sc">%&gt;%</span></span>
<span id="cb76-234"><a href="#cb76-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-235"><a href="#cb76-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span> <span class="co"># This function from tidyr converts a selection of variables into two variables: a key and a value. The key contains the names of the original variable and the value the data. This means we can then use the facet_wrap function from ggplot2</span></span>
<span id="cb76-236"><a href="#cb76-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(value)) <span class="sc">+</span></span>
<span id="cb76-237"><a href="#cb76-237" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb76-238"><a href="#cb76-238" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> key, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb76-239"><a href="#cb76-239" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb76-240"><a href="#cb76-240" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">colour=</span> <span class="st">"darkred"</span>, <span class="at">fill =</span> <span class="st">"darkred"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb76-241"><a href="#cb76-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-242"><a href="#cb76-242" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(here("plots", "TEC-zscores-HistogramsAllVariablesTEC-only.svg"), width = 20, height = 45)</span></span>
<span id="cb76-243"><a href="#cb76-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-244"><a href="#cb76-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-245"><a href="#cb76-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-246"><a href="#cb76-246" aria-hidden="true" tabindex="-1"></a><span class="fu">### Transforming the features to (partially) deskew these distributions</span></span>
<span id="cb76-247"><a href="#cb76-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-248"><a href="#cb76-248" aria-hidden="true" tabindex="-1"></a>Signed log transformation function inspired by the SignedLog function proposed in https://cran.r-project.org/web/packages/DataVisualizations/DataVisualizations.pdf</span>
<span id="cb76-249"><a href="#cb76-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-252"><a href="#cb76-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-253"><a href="#cb76-253" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: signed.log.transformation</span></span>
<span id="cb76-254"><a href="#cb76-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-255"><a href="#cb76-255" aria-hidden="true" tabindex="-1"></a><span class="co"># All features are signed log-transformed (this is also what Neumann &amp; Evert 2021 do)</span></span>
<span id="cb76-256"><a href="#cb76-256" aria-hidden="true" tabindex="-1"></a>signed.log <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb76-257"><a href="#cb76-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sign</span>(x) <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">abs</span>(x) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb76-258"><a href="#cb76-258" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-259"><a href="#cb76-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-260"><a href="#cb76-260" aria-hidden="true" tabindex="-1"></a>TxBzlogcounts <span class="ot">&lt;-</span> <span class="fu">signed.log</span>(TxBzcounts) <span class="co"># Standardise first, then signed log transform</span></span>
<span id="cb76-261"><a href="#cb76-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-262"><a href="#cb76-262" aria-hidden="true" tabindex="-1"></a><span class="co"># The function above would only transform the most skewed variables. This is what Lee suggests doing but it makes the interpretation of the correlations quite tricky so I abandoned this idea.</span></span>
<span id="cb76-263"><a href="#cb76-263" aria-hidden="true" tabindex="-1"></a><span class="co"># TxBzlogcounts2 &lt;- TxBzcounts %&gt;%</span></span>
<span id="cb76-264"><a href="#cb76-264" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.data.frame() %&gt;% </span></span>
<span id="cb76-265"><a href="#cb76-265" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(across(.cols = c(AMP, ASPECT, CAUSE, COND, CUZ, DMA, EMPH, EX, EXIST, FPP1P, FPP1S, FPUH, FREQ, HDG, MDCA, MDCO, MDNE, MDWO, MDWS, OCCUR, PASS, PEAS, PLACE, POLITE, PROG, QUPR, RP, SPLIT, STPR, THATD, THRC, THSC, TPP3P, TPP3S, VBD, VBG, VBN, VIMP, WHQU, WHSC, YNQU),</span></span>
<span id="cb76-266"><a href="#cb76-266" aria-hidden="true" tabindex="-1"></a><span class="co">#         .fns = signed.log)) %&gt;% </span></span>
<span id="cb76-267"><a href="#cb76-267" aria-hidden="true" tabindex="-1"></a><span class="co">#     rename_with(.cols = c(AMP, ASPECT, CAUSE, COND, CUZ, DMA, EMPH, EX, EXIST, FPP1P, FPP1S, FPUH, FREQ, HDG, MDCA, MDCO, MDNE, MDWO, MDWS, OCCUR, PASS, PEAS, PLACE, POLITE, PROG, QUPR, RP, SPLIT, STPR, THATD, THRC, THSC, TPP3P, TPP3S, VBD, VBG, VBN, VIMP, WHQU, WHSC, YNQU),</span></span>
<span id="cb76-268"><a href="#cb76-268" aria-hidden="true" tabindex="-1"></a><span class="co">#                 .fn = ~paste0(., '_signedlog'))</span></span>
<span id="cb76-269"><a href="#cb76-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-270"><a href="#cb76-270" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(TxBzlogcounts, <span class="at">las=</span><span class="dv">3</span>, <span class="at">main=</span><span class="st">"log-transformed z-scores"</span>)</span>
<span id="cb76-271"><a href="#cb76-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-272"><a href="#cb76-272" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(TxBzlogcounts, here("processed_data", "TxBzlogcounts.rds")) # Last saved 16 Feb 2024</span></span>
<span id="cb76-273"><a href="#cb76-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-274"><a href="#cb76-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-277"><a href="#cb76-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-278"><a href="#cb76-278" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: signed.log.transformation-distributions</span></span>
<span id="cb76-279"><a href="#cb76-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 40</span></span>
<span id="cb76-280"><a href="#cb76-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-281"><a href="#cb76-281" aria-hidden="true" tabindex="-1"></a>TxBzlogcounts <span class="sc">%&gt;%</span></span>
<span id="cb76-282"><a href="#cb76-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-283"><a href="#cb76-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span> <span class="co"># This function from tidyr converts a selection of variables into two variables: a key and a value. The key contains the names of the original variable and the value the data. This means we can then use the facet_wrap function from ggplot2</span></span>
<span id="cb76-284"><a href="#cb76-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(value, <span class="fu">after_stat</span>(density))) <span class="sc">+</span></span>
<span id="cb76-285"><a href="#cb76-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb76-286"><a href="#cb76-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> key, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb76-287"><a href="#cb76-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb76-288"><a href="#cb76-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb76-289"><a href="#cb76-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">colour=</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb76-290"><a href="#cb76-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">colour =</span> <span class="st">"darkred"</span>, <span class="at">weight =</span> <span class="dv">2</span>, <span class="at">fill=</span><span class="st">"darkred"</span>, <span class="at">alpha =</span> .<span class="dv">4</span>)</span>
<span id="cb76-291"><a href="#cb76-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-292"><a href="#cb76-292" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(here("plots", "DensityPlotsAllVariablesSignedLog-TEC-only.svg"), width = 15, height = 49)</span></span>
<span id="cb76-293"><a href="#cb76-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-294"><a href="#cb76-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-295"><a href="#cb76-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-296"><a href="#cb76-296" aria-hidden="true" tabindex="-1"></a>These plots serve to illustrate the effects of the variable transformations performed in the above chunks.</span>
<span id="cb76-297"><a href="#cb76-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-300"><a href="#cb76-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-301"><a href="#cb76-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-correlation-plots</span></span>
<span id="cb76-302"><a href="#cb76-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 30</span></span>
<span id="cb76-303"><a href="#cb76-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-304"><a href="#cb76-304" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a slightly amended version of the PerformanceAnalytics::chart.Correlation() function. It simply removes the significance stars that are meaningless with this many data points (see commented out lines below)</span></span>
<span id="cb76-305"><a href="#cb76-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-306"><a href="#cb76-306" aria-hidden="true" tabindex="-1"></a>chart.Correlation.nostars <span class="ot">&lt;-</span> <span class="cf">function</span> (R, <span class="at">histogram =</span> <span class="cn">TRUE</span>, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"pearson"</span>, <span class="st">"kendall"</span>, <span class="st">"spearman"</span>), ...) {</span>
<span id="cb76-307"><a href="#cb76-307" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">checkData</span>(R, <span class="at">method =</span> <span class="st">"matrix"</span>)</span>
<span id="cb76-308"><a href="#cb76-308" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">missing</span>(method)) </span>
<span id="cb76-309"><a href="#cb76-309" aria-hidden="true" tabindex="-1"></a>    method <span class="ot">=</span> method[<span class="dv">1</span>]</span>
<span id="cb76-310"><a href="#cb76-310" aria-hidden="true" tabindex="-1"></a>  panel.cor <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">prefix =</span> <span class="st">""</span>, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>, <span class="at">method =</span> <span class="st">"pearson"</span>, cex.cor, ...) {</span>
<span id="cb76-311"><a href="#cb76-311" aria-hidden="true" tabindex="-1"></a>    usr <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="st">"usr"</span>)</span>
<span id="cb76-312"><a href="#cb76-312" aria-hidden="true" tabindex="-1"></a>    <span class="fu">on.exit</span>(<span class="fu">par</span>(usr))</span>
<span id="cb76-313"><a href="#cb76-313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb76-314"><a href="#cb76-314" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">cor</span>(x, y, <span class="at">use =</span> use, <span class="at">method =</span> method)</span>
<span id="cb76-315"><a href="#cb76-315" aria-hidden="true" tabindex="-1"></a>    txt <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">c</span>(r, <span class="fl">0.123456789</span>), <span class="at">digits =</span> digits)[<span class="dv">1</span>]</span>
<span id="cb76-316"><a href="#cb76-316" aria-hidden="true" tabindex="-1"></a>    txt <span class="ot">&lt;-</span> <span class="fu">paste</span>(prefix, txt, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb76-317"><a href="#cb76-317" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(cex.cor)) </span>
<span id="cb76-318"><a href="#cb76-318" aria-hidden="true" tabindex="-1"></a>      cex <span class="ot">&lt;-</span> <span class="fl">0.8</span><span class="sc">/</span><span class="fu">strwidth</span>(txt)</span>
<span id="cb76-319"><a href="#cb76-319" aria-hidden="true" tabindex="-1"></a>    test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(<span class="fu">as.numeric</span>(x), <span class="fu">as.numeric</span>(y), <span class="at">method =</span> method)</span>
<span id="cb76-320"><a href="#cb76-320" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Signif &lt;- symnum(test$p.value, corr = FALSE, na = FALSE, </span></span>
<span id="cb76-321"><a href="#cb76-321" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                  cutpoints = c(0, 0.001, 0.01, 0.05, 0.1, 1), symbols = c("***", </span></span>
<span id="cb76-322"><a href="#cb76-322" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                                                                           "**", "*", ".", " "))</span></span>
<span id="cb76-323"><a href="#cb76-323" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, txt, <span class="at">cex =</span> cex <span class="sc">*</span> (<span class="fu">abs</span>(r) <span class="sc">+</span> <span class="fl">0.3</span>)<span class="sc">/</span><span class="fl">1.3</span>)</span>
<span id="cb76-324"><a href="#cb76-324" aria-hidden="true" tabindex="-1"></a>    <span class="co"># text(0.8, 0.8, Signif, cex = cex, col = 2)</span></span>
<span id="cb76-325"><a href="#cb76-325" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-326"><a href="#cb76-326" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="cf">function</span>(t) {</span>
<span id="cb76-327"><a href="#cb76-327" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dnorm</span>(t, <span class="at">mean =</span> <span class="fu">mean</span>(x), <span class="at">sd =</span> <span class="fu">sd.xts</span>(x))</span>
<span id="cb76-328"><a href="#cb76-328" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-329"><a href="#cb76-329" aria-hidden="true" tabindex="-1"></a>  dotargs <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb76-330"><a href="#cb76-330" aria-hidden="true" tabindex="-1"></a>  dotargs<span class="sc">$</span>method <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb76-331"><a href="#cb76-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(method)</span>
<span id="cb76-332"><a href="#cb76-332" aria-hidden="true" tabindex="-1"></a>  hist.panel <span class="ot">=</span> <span class="cf">function</span>(x, <span class="at">... =</span> <span class="cn">NULL</span>) {</span>
<span id="cb76-333"><a href="#cb76-333" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">new =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-334"><a href="#cb76-334" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(x, <span class="at">col =</span> <span class="st">"light gray"</span>, <span class="at">probability =</span> <span class="cn">TRUE</span>, </span>
<span id="cb76-335"><a href="#cb76-335" aria-hidden="true" tabindex="-1"></a>         <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">""</span>, <span class="at">breaks =</span> <span class="st">"FD"</span>)</span>
<span id="cb76-336"><a href="#cb76-336" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="fu">density</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">1</span>)</span>
<span id="cb76-337"><a href="#cb76-337" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rug</span>(x)</span>
<span id="cb76-338"><a href="#cb76-338" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-339"><a href="#cb76-339" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (histogram) </span>
<span id="cb76-340"><a href="#cb76-340" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pairs</span>(x, <span class="at">gap =</span> <span class="dv">0</span>, <span class="at">lower.panel =</span> panel.smooth, <span class="at">upper.panel =</span> panel.cor, </span>
<span id="cb76-341"><a href="#cb76-341" aria-hidden="true" tabindex="-1"></a>          <span class="at">diag.panel =</span> hist.panel)</span>
<span id="cb76-342"><a href="#cb76-342" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="fu">pairs</span>(x, <span class="at">gap =</span> <span class="dv">0</span>, <span class="at">lower.panel =</span> panel.smooth, <span class="at">upper.panel =</span> panel.cor)</span>
<span id="cb76-343"><a href="#cb76-343" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-344"><a href="#cb76-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-345"><a href="#cb76-345" aria-hidden="true" tabindex="-1"></a><span class="co"># Example plot without any variable transformation</span></span>
<span id="cb76-346"><a href="#cb76-346" aria-hidden="true" tabindex="-1"></a>example1 <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span></span>
<span id="cb76-347"><a href="#cb76-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NN,PROG,SPLIT,ACT,FPP1S)</span>
<span id="cb76-348"><a href="#cb76-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-349"><a href="#cb76-349" aria-hidden="true" tabindex="-1"></a><span class="co">#png(here("plots", "CorrChart-TEC-examples-normedcounts.png"), width = 20, height = 20, units = "cm", res = 300)</span></span>
<span id="cb76-350"><a href="#cb76-350" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Correlation.nostars</span>(example1, <span class="at">histogram=</span><span class="cn">TRUE</span>, <span class="at">pch=</span><span class="dv">19</span>)</span>
<span id="cb76-351"><a href="#cb76-351" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb76-352"><a href="#cb76-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-353"><a href="#cb76-353" aria-hidden="true" tabindex="-1"></a><span class="co"># Example plot with transformed variables</span></span>
<span id="cb76-354"><a href="#cb76-354" aria-hidden="true" tabindex="-1"></a>example2 <span class="ot">&lt;-</span> TxBzlogcounts <span class="sc">%&gt;%</span></span>
<span id="cb76-355"><a href="#cb76-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-356"><a href="#cb76-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NN,PROG,SPLIT,ACT,FPP1S)</span>
<span id="cb76-357"><a href="#cb76-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-358"><a href="#cb76-358" aria-hidden="true" tabindex="-1"></a><span class="co">#png(here("plots", "CorrChart-TEC-examples-zsignedlogcounts.png"), width = 20, height = 20, units = "cm", res = 300)</span></span>
<span id="cb76-359"><a href="#cb76-359" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Correlation.nostars</span>(example2, <span class="at">histogram=</span><span class="cn">TRUE</span>, <span class="at">pch=</span><span class="dv">19</span>)</span>
<span id="cb76-360"><a href="#cb76-360" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb76-361"><a href="#cb76-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-362"><a href="#cb76-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-363"><a href="#cb76-363" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualisation of feature correlations</span></span>
<span id="cb76-364"><a href="#cb76-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-367"><a href="#cb76-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-368"><a href="#cb76-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: heatmap</span></span>
<span id="cb76-369"><a href="#cb76-369" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 30</span></span>
<span id="cb76-370"><a href="#cb76-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-371"><a href="#cb76-371" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple heatmap in base R (inspired by Stephanie Evert's SIGIL code)</span></span>
<span id="cb76-372"><a href="#cb76-372" aria-hidden="true" tabindex="-1"></a>cor.colours <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb76-373"><a href="#cb76-373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hsv</span>(<span class="at">h=</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">v=</span><span class="dv">1</span>, <span class="at">s=</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">10</span>), <span class="co"># blue = negative correlation </span></span>
<span id="cb76-374"><a href="#cb76-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="co"># white = no correlation </span></span>
<span id="cb76-375"><a href="#cb76-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hsv</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">v=</span><span class="dv">1</span>, <span class="at">s=</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">/</span><span class="dv">10</span>))) <span class="co"># red = positive correlation</span></span>
<span id="cb76-376"><a href="#cb76-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-377"><a href="#cb76-377" aria-hidden="true" tabindex="-1"></a><span class="co">#png(here("plots", "heatmapzlogcounts-TEC-only.png"), width = 30, height= 30, units = "cm", res = 300)</span></span>
<span id="cb76-378"><a href="#cb76-378" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(<span class="fu">cor</span>(TxBzlogcounts), </span>
<span id="cb76-379"><a href="#cb76-379" aria-hidden="true" tabindex="-1"></a>        <span class="at">symm=</span><span class="cn">TRUE</span>, </span>
<span id="cb76-380"><a href="#cb76-380" aria-hidden="true" tabindex="-1"></a>        <span class="at">zlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb76-381"><a href="#cb76-381" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span>cor.colours, </span>
<span id="cb76-382"><a href="#cb76-382" aria-hidden="true" tabindex="-1"></a>        <span class="at">margins=</span><span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">7</span>))</span>
<span id="cb76-383"><a href="#cb76-383" aria-hidden="true" tabindex="-1"></a><span class="co">#dev.off()</span></span>
<span id="cb76-384"><a href="#cb76-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-385"><a href="#cb76-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-386"><a href="#cb76-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-387"><a href="#cb76-387" aria-hidden="true" tabindex="-1"></a><span class="fu">## Composition of TEC texts/files entered in the MDAs</span></span>
<span id="cb76-388"><a href="#cb76-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-391"><a href="#cb76-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-392"><a href="#cb76-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: TEC-metadata</span></span>
<span id="cb76-393"><a href="#cb76-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-394"><a href="#cb76-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of words</span></span>
<span id="cb76-395"><a href="#cb76-395" aria-hidden="true" tabindex="-1"></a>TxBcounts <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">sum</span>(Words))</span>
<span id="cb76-396"><a href="#cb76-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-397"><a href="#cb76-397" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span> </span>
<span id="cb76-398"><a href="#cb76-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Filename, Country, Series, Level, Register, Words) <span class="sc">%&gt;%</span> </span>
<span id="cb76-399"><a href="#cb76-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Volume =</span> <span class="fu">paste</span>(Series, Level)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-400"><a href="#cb76-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Volume =</span> <span class="fu">fct_rev</span>(Volume)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-401"><a href="#cb76-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Volume =</span> <span class="fu">fct_reorder</span>(Volume, <span class="fu">as.numeric</span>(Level))) <span class="sc">%&gt;%</span> </span>
<span id="cb76-402"><a href="#cb76-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Volume) <span class="sc">%&gt;%</span> </span>
<span id="cb76-403"><a href="#cb76-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wordcount =</span> <span class="fu">sum</span>(Words)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-404"><a href="#cb76-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-405"><a href="#cb76-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Volume, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-406"><a href="#cb76-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-407"><a href="#cb76-407" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for book</span></span>
<span id="cb76-408"><a href="#cb76-408" aria-hidden="true" tabindex="-1"></a>metadata2 <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span> </span>
<span id="cb76-409"><a href="#cb76-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, Series, Level, Register, Words) <span class="sc">%&gt;%</span> </span>
<span id="cb76-410"><a href="#cb76-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Volume =</span> <span class="fu">paste</span>(Series, Level)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-411"><a href="#cb76-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Volume =</span> <span class="fu">fct_rev</span>(Volume)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-412"><a href="#cb76-412" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(Volume = fct_reorder(Volume, as.numeric(Level))) %&gt;% </span></span>
<span id="cb76-413"><a href="#cb76-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Volume, Register) <span class="sc">%&gt;%</span> </span>
<span id="cb76-414"><a href="#cb76-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wordcount =</span> <span class="fu">sum</span>(Words)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-415"><a href="#cb76-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-416"><a href="#cb76-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Volume, Register, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-417"><a href="#cb76-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-418"><a href="#cb76-418" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the palette created above on the basis of the suffrager pakcage (but without needed to install the package)</span></span>
<span id="cb76-419"><a href="#cb76-419" aria-hidden="true" tabindex="-1"></a>palette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#BD241E"</span>, <span class="st">"#A18A33"</span>, <span class="st">"#15274D"</span>, <span class="st">"#D54E1E"</span>, <span class="st">"#EA7E1E"</span>, <span class="st">"#4C4C4C"</span>, <span class="st">"#722672"</span>, <span class="st">"#F9B921"</span>, <span class="st">"#267226"</span>)</span>
<span id="cb76-420"><a href="#cb76-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-421"><a href="#cb76-421" aria-hidden="true" tabindex="-1"></a>PlotSp <span class="ot">&lt;-</span> metadata2 <span class="sc">%&gt;%</span> </span>
<span id="cb76-422"><a href="#cb76-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">"Spain"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-423"><a href="#cb76-423" aria-hidden="true" tabindex="-1"></a>  <span class="co">#arrange(Volume) %&gt;% </span></span>
<span id="cb76-424"><a href="#cb76-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Volume, <span class="at">y =</span> wordcount, <span class="at">fill =</span> <span class="fu">fct_rev</span>(Register))) <span class="sc">+</span> </span>
<span id="cb76-425"><a href="#cb76-425" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb76-426"><a href="#cb76-426" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># Removes those annoying ticks before each bar label</span></span>
<span id="cb76-427"><a href="#cb76-427" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb76-428"><a href="#cb76-428" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Spain"</span>, <span class="at">y =</span> <span class="st">"Cumulative word count"</span>) <span class="sc">+</span></span>
<span id="cb76-429"><a href="#cb76-429" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> palette[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)], </span>
<span id="cb76-430"><a href="#cb76-430" aria-hidden="true" tabindex="-1"></a>                      <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb76-431"><a href="#cb76-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-432"><a href="#cb76-432" aria-hidden="true" tabindex="-1"></a>PlotGer <span class="ot">&lt;-</span> metadata2 <span class="sc">%&gt;%</span> </span>
<span id="cb76-433"><a href="#cb76-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">"Germany"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-434"><a href="#cb76-434" aria-hidden="true" tabindex="-1"></a>  <span class="co">#arrange(Volume) %&gt;% </span></span>
<span id="cb76-435"><a href="#cb76-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Volume, <span class="at">y =</span> wordcount, <span class="at">fill =</span> <span class="fu">fct_rev</span>(Register))) <span class="sc">+</span> </span>
<span id="cb76-436"><a href="#cb76-436" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb76-437"><a href="#cb76-437" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb76-438"><a href="#cb76-438" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Germany"</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb76-439"><a href="#cb76-439" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> palette[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)], <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb76-440"><a href="#cb76-440" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb76-441"><a href="#cb76-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-442"><a href="#cb76-442" aria-hidden="true" tabindex="-1"></a>PlotFr <span class="ot">&lt;-</span> metadata2 <span class="sc">%&gt;%</span> </span>
<span id="cb76-443"><a href="#cb76-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">"France"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-444"><a href="#cb76-444" aria-hidden="true" tabindex="-1"></a>  <span class="co">#arrange(Volume) %&gt;% </span></span>
<span id="cb76-445"><a href="#cb76-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Volume, <span class="at">y =</span> wordcount, <span class="at">fill =</span> <span class="fu">fct_rev</span>(Register))) <span class="sc">+</span> </span>
<span id="cb76-446"><a href="#cb76-446" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb76-447"><a href="#cb76-447" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb76-448"><a href="#cb76-448" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"France"</span>, <span class="at">y  =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Register subcorpus"</span>) <span class="sc">+</span></span>
<span id="cb76-449"><a href="#cb76-449" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> palette[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)], <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>, <span class="at">legend.hjust =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb76-450"><a href="#cb76-450" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>, <span class="at">legend.justification =</span> <span class="st">"left"</span>)</span>
<span id="cb76-451"><a href="#cb76-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-452"><a href="#cb76-452" aria-hidden="true" tabindex="-1"></a>PlotFr <span class="sc">/</span></span>
<span id="cb76-453"><a href="#cb76-453" aria-hidden="true" tabindex="-1"></a>PlotGer <span class="sc">/</span></span>
<span id="cb76-454"><a href="#cb76-454" aria-hidden="true" tabindex="-1"></a>PlotSp</span>
<span id="cb76-455"><a href="#cb76-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-456"><a href="#cb76-456" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(here("plots", "TEC-T_wordcounts_book.svg"), width = 8, height = 12)</span></span>
<span id="cb76-457"><a href="#cb76-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-458"><a href="#cb76-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-459"><a href="#cb76-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-462"><a href="#cb76-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-463"><a href="#cb76-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: TEC-metadata2</span></span>
<span id="cb76-464"><a href="#cb76-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-465"><a href="#cb76-465" aria-hidden="true" tabindex="-1"></a><span class="co"># Meta-data on % of instructional language in each textbook</span></span>
<span id="cb76-466"><a href="#cb76-466" aria-hidden="true" tabindex="-1"></a>metadataInstr <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span> </span>
<span id="cb76-467"><a href="#cb76-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, Series, Level, Register, Words) <span class="sc">%&gt;%</span> </span>
<span id="cb76-468"><a href="#cb76-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Register<span class="sc">==</span><span class="st">"Instructional"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-469"><a href="#cb76-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Volume =</span> <span class="fu">paste</span>(Series, Register)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-470"><a href="#cb76-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Volume =</span> <span class="fu">fct_rev</span>(Volume)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-471"><a href="#cb76-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Volume =</span> <span class="fu">fct_reorder</span>(Volume, <span class="fu">as.numeric</span>(Level))) <span class="sc">%&gt;%</span> </span>
<span id="cb76-472"><a href="#cb76-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Volume, Register) <span class="sc">%&gt;%</span> </span>
<span id="cb76-473"><a href="#cb76-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">InstrWordcount =</span> <span class="fu">sum</span>(Words)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-474"><a href="#cb76-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-475"><a href="#cb76-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Volume, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-476"><a href="#cb76-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Series, InstrWordcount)</span>
<span id="cb76-477"><a href="#cb76-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-478"><a href="#cb76-478" aria-hidden="true" tabindex="-1"></a>metadataInstr</span>
<span id="cb76-479"><a href="#cb76-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-480"><a href="#cb76-480" aria-hidden="true" tabindex="-1"></a>metaWordcount <span class="ot">&lt;-</span> TxBcounts <span class="sc">%&gt;%</span> </span>
<span id="cb76-481"><a href="#cb76-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, Series, Level, Register, Words) <span class="sc">%&gt;%</span> </span>
<span id="cb76-482"><a href="#cb76-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Series) <span class="sc">%&gt;%</span> </span>
<span id="cb76-483"><a href="#cb76-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TECwordcount =</span> <span class="fu">sum</span>(Words)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-484"><a href="#cb76-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-485"><a href="#cb76-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Series, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-486"><a href="#cb76-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Series, TECwordcount)</span>
<span id="cb76-487"><a href="#cb76-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-488"><a href="#cb76-488" aria-hidden="true" tabindex="-1"></a>wordcount <span class="ot">&lt;-</span> <span class="fu">merge</span>(metaWordcount, metadataInstr, <span class="at">by =</span> <span class="st">"Series"</span>)</span>
<span id="cb76-489"><a href="#cb76-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-490"><a href="#cb76-490" aria-hidden="true" tabindex="-1"></a>wordcount <span class="sc">%&gt;%</span> </span>
<span id="cb76-491"><a href="#cb76-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">InstrucPercent =</span> InstrWordcount<span class="sc">/</span>TECwordcount<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-492"><a href="#cb76-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(InstrucPercent) <span class="sc">%&gt;%</span> </span>
<span id="cb76-493"><a href="#cb76-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">InstrucPercent =</span> <span class="fu">round</span>(InstrucPercent, <span class="dv">2</span>))</span>
<span id="cb76-494"><a href="#cb76-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-495"><a href="#cb76-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-496"><a href="#cb76-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-497"><a href="#cb76-497" aria-hidden="true" tabindex="-1"></a><span class="fu"># Packages used in this script</span></span>
<span id="cb76-498"><a href="#cb76-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-501"><a href="#cb76-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb76-502"><a href="#cb76-502" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: package-citations</span></span>
<span id="cb76-503"><a href="#cb76-503" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb76-504"><a href="#cb76-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-505"><a href="#cb76-505" aria-hidden="true" tabindex="-1"></a><span class="co">#packages.bib &lt;- sapply(1:length(loadedNamespaces()), function(i) toBibtex(citation(loadedNamespaces()[i])))</span></span>
<span id="cb76-506"><a href="#cb76-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-507"><a href="#cb76-507" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">write_bib</span>(<span class="fu">c</span>(<span class="fu">.packages</span>(), <span class="st">"knitr"</span>), <span class="st">"packages.bib"</span>)</span>
<span id="cb76-508"><a href="#cb76-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-509"><a href="#cb76-509" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb76-510"><a href="#cb76-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-511"><a href="#cb76-511" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>